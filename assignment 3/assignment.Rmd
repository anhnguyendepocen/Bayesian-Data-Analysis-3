---
title: "Bayesian Data Analysis - Assignment 3"
author: "Anonymous"
output: 
  pdf_document: 
    toc: yes
    toc_depth: 2
bibliography: bibliography.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

@bayesian_data_analysis_2013, chapters 3.1 - 3.2

Load `aaltobda` library and `winsdhield` data.
```{r}
library(aaltobda)
data("windshieldy1")
data("windshieldy2")
```

## Inference for normal mean and deviation
Observed hardness values $\mathbf{y}_1$. Assumed to be normally distributed with unknown standard deviation $\sigma$ and unknown average hardness $\mu.$ We formulate our Baysian model with noninformative prior.

Sample mean
$$
\overline{y}=\frac{1}{n}\sum_{i=1}^n y_i
$$
Sample variance
$$
s^2 = \frac{1}{n-1}\sum_{i=1}^n (y_i - \overline{y})^2
$$

### a)
Bayesian point estimate: Expected value of conditional posterior distribution, sample mean

$$
E(p(\mu\mid \sigma^2, y))=\overline{y}
$$

```{r}
mu_point_est <- function(data) {
  mean(data)
}
mu_point_est(windshieldy1)
```

Bayesian interval estimate: Stundent's $t$ ditribution

$$
t_{n-1}(\overline{y}, s/\sqrt{n})
$$

```{r}
mu_interval <- function(data, prob) {
  n = length(data)
  y = mean(data)
  s_squared = 1 / (n-1) * sum((data - y)^2)
  scale = sqrt(s_squared/n)
  a = (1 - prob)/2
  scale * qt(c(a, a+prob), df = n - 1) + y
}
mu_interval(windshieldy1, 0.95)
```

Density plot
```{r}
data = windshieldy1
n = length(data)
y = mean(data)
s_squared = 1 / (n-1) * sum((data - y)^2)
scale = sqrt(s_squared/n)
x = seq(y-2*s_squared, y+2*s_squared, 0.1)
df = n - 1
d = dtnew(x, df, y, scale)
plot(x, d, type = "l")
```

### b)
Bayesian point estimate: Expected value of posterior predictive distribution $\overline{y}$

```{r}
mu_pred_point_est <- function(data) {
  mean(data)
}
mu_pred_point_est(windshieldy1)
```

Bayesian interval estimate: Student's $t$ ditribution

$$
t_{n-1}\left(\overline{y}, s\sqrt{1+\frac{1}{n}}\right)
$$

```{r}
mu_pred_interval <- function(data, prob) {
  n = length(data)
  y = mean(data)
  s_squared = 1 / (n-1) * sum((data - y)^2)
  s = sqrt(s_squared)
  scale = sqrt(1 + 1/n) * s
  a = (1 - prob)/2
  scale * qt(c(a, a+prob), df = n - 1) + y
}
mu_pred_interval(windshieldy1, 0.95)
```

Density plot
```{r}
data = windshieldy1
n = length(data)
y = mean(data)
s_squared = 1 / (n-1) * sum((data - y)^2)
s = sqrt(s_squared)
scale = sqrt(1 + 1/n) * s
x = seq(y-2*s_squared, y+2*s_squared, 0.1)
df = n - 1
d = dtnew(x, df, y, scale)
plot(x, d, type = "l")
```


## Inference for the difference between proportions
```{r}
# Control
n0 = 674
y0 = 39
# Treatment
n1 = 680
y1 = 22
```

### a)
Point estimate
```{r}
p0 <- rbeta(100000, y0 + 1, n0 - y0 + 1)
p1 <- rbeta(100000, y1 + 1, n1 - y1 + 1)
posterior_odds_ratio_point_est <- function(p0, p1) {
  mean((p1/(1-p1))/(p0/(1-p0)))
}
posterior_odds_ratio_point_est(p0, p1)
```

### b)
Interval estimate
```{r}
posterior_odds_ratio_interval <- function(p0, p1, prob) {
  a = (1-prob)/2
  quantile((p1/(1-p1))/(p0/(1-p0)), c(a, a+prob))
}
posterior_odds_ratio_interval(p0, p1, prob = 0.9)
```

Histogram
```{r}
hist((p1/(1-p1))/(p0/(1-p0)), breaks = 100)
```

## Inference for the difference between normal means
### a)
### b)

## References
